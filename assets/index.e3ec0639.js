var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,s=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&o(e,a,t[a]);if(n)for(var a of n(t))l.call(t,a)&&o(e,a,t[a]);return e},c=(e,n)=>t(e,a(n));import{c as i,u,a as m,R as d,F as p,T as E,b as g,d as h,I as f,L as y,e as v,r as b,f as x,g as C,h as w,i as S,j as I,k as O,l as P,m as F,n as D,o as _,p as V,q as z,S as j,B as k,s as H,t as N,v as R,w as Y,M as T,x as M,y as L,z as U,A,C as W,D as q,E as B,G as Q,H as G,J,K as X,N as $,O as K,P as Z,Q as ee,U as te,V as ae,W as ne,X as re}from"./vendor.05bbaace.js";const le=i("https://sctuwgacucgmlfzywnvm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNjE2MjYxOSwiZXhwIjoxOTQxNzM4NjE5fQ.05_kxuSWS9RdNG_ba1KQIMXIcYXe_sD_eoPqlszQyAQ");function oe({isLogin:e}){const t=u();let a=m();le.auth.session()&&a.push("/home");return d.createElement(p,{height:"100vh",alignItems:"center",justifyContent:"center"},d.createElement(p,{direction:"column",backgroundColor:"gray.100",p:12,rounded:6},d.createElement(E,{mb:6,textAlign:"center",fontWeight:"bold"},e?"Login":"Signup"),d.createElement("form",{onSubmit:async n=>{n.preventDefault();const{email:{value:r},password:{value:l}}=n.target,o={email:r,password:l};if(e){const{error:e}=await le.auth.signIn(o);e&&t({title:e.message,position:"top",status:"error",isClosable:!0}),a.push("/home")}else{const{error:e}=await le.auth.signUp(o);e&&t({title:e.message,position:"top",status:"error",isClosable:!0})}}},d.createElement(g,{id:"email",isRequired:!0},d.createElement(h,{fontSize:"85%"},"Email"),d.createElement(f,{borderColor:"blackAlpha.300",mb:6,variant:"filled",placeholder:"Email",type:"email",name:"email"})),d.createElement(g,{id:"Password",isRequired:!0},d.createElement(h,{fontSize:"85%"},"Password"),d.createElement(f,{borderColor:"blackAlpha.300",type:"password",mb:6,variant:"filled",placeholder:"*********",name:"password"})),d.createElement(f,{type:"submit",bgColor:"#1293d2",color:"#fff",value:e?"Login":"Signup"})," "),d.createElement(E,{mt:3},d.createElement(y,{as:v,to:e?"/signup":"/login"},e?"do not have account? Signup here":"Already have account? Login here"))))}function se({columns:e,data:t}){const{getTableProps:a,getTableBodyProps:n,headerGroups:r,rows:l,prepareRow:o}=b.exports.useTable({columns:e,data:t},b.exports.useSortBy);return d.createElement(x,s({manualSortBy:!0,variant:"striped",colorScheme:"telegram"},a()),d.createElement(C,null,r.map((e=>d.createElement(w,s({},e.getHeaderGroupProps()),e.headers.map((e=>d.createElement(S,c(s({},e.getHeaderProps(e.getSortByToggleProps())),{isNumeric:e.isNumeric}),e.render("Header"),d.createElement(I.span,{pl:"4"},e.isSorted?e.isSortedDesc?d.createElement(O,{"aria-label":"sorted descending"}):d.createElement(P,{"aria-label":"sorted ascending"}):null)))))))),d.createElement(F,s({},n()),l.map((e=>(o(e),d.createElement(w,s({},e.getRowProps()),e.cells.map((e=>d.createElement(D,c(s({},e.getCellProps()),{isNumeric:e.column.isNumeric}),e.render("Cell"))))))))))}function ce(e){return e.map((e=>c(s({},e),{date:_.unix(e.date).format("DD-MM-YYYY")})))}const ie=[{Header:"Code",accessor:"scheme_code"},{Header:"Name",accessor:"scheme_name"},{Header:"Source",accessor:"bank_name"},{Header:"Units",accessor:"total_units",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Invested",accessor:"total_amount",isNumeric:!0,sortable:!0,sortMethod:(e,t,a)=>{console.log(e,t)}},{Header:"Nav Date",accessor:"lastDate",isNumeric:!0},{Header:"Current Value",accessor:"todayValue",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Revenue",accessor:"difference",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Revenue %",accessor:"revenue%",sortable:!0,sortType:({values:e},{values:t},a,n)=>e.difference/e.total_amount*100>t.difference/t.total_amount*100?1:-1,Cell:({row:{values:{difference:e,total_amount:t}}})=>{const a=e/t*100;return d.createElement(d.Fragment,null,d.createElement(Y,{type:e>0?"increase":"decrease"}),a.toFixed(2))}},{Header:"Day Change",accessor:"preValue",sortType:({values:e},{values:t},a,n)=>e.todayValue-e.preValue>t.todayValue-t.preValue?1:-1,Cell:({row:{values:{todayValue:e,preValue:t}}})=>{const a=e-t;return d.createElement(d.Fragment,null,d.createElement(Y,{type:a>0?"increase":"decrease"}),a.toFixed(2))}}],ue={totalInvested:"Total Invested",currentValue:"Current Value",totalRealized:"Realized",totalUnRealized:"Un Realized",profitPercentage:"Difference %",totalDayChange:"Day Change",dayChangePercentage:"Day Change %"};function me(){const[e,t]=z.exports.useState([]),[a,n]=z.exports.useState({totalInvested:0,currentValue:0,totalDayChange:0,totalRealized:0,totalUnRealized:0,profitPercentage:0,dayChangePercentage:0});return z.exports.useEffect((async()=>{if(0===e.length){const e=le.auth.user(),{data:a}=await le.rpc("mf_summary").eq("user_id",e.id),r=await Promise.all(a.map((async e=>{const[t,a]=await(async e=>{var t,a;const{data:n,error:r}=await le.from("navHistory").select("*").eq("schemeCode",e).order("id",{ascending:!1}).limit(2);if(n.length){const e=_();if([1,7].includes(e.isoWeekday()))return ce(n);if(e.diff(_.unix(n[0].date),"days")<=1)return ce(n)}const l=await V.get(`https://api.mfapi.in/mf/${e}`),o=n.length?null==(t=null==l?void 0:l.data)?void 0:t.data.splice(0,5):null==(a=null==l?void 0:l.data)?void 0:a.data;return await le.from("navHistory").upsert(o.map((t=>{const a=_(t.date,"DD-MM-YYYY").unix();return c(s({},t),{date:a,schemeCode:e,id:`${e}_${a}`})}))),o.splice(0,2)})(e.scheme_code),n=t.nav*e.total_units,r=n-e.total_amount;return c(s({},e),{nav:t.nav,lastDate:t.date,preNav:a.nav,preValue:a.nav*e.total_units,todayValue:n,difference:r})}))),l=r.reduce(((e,t)=>e+t.total_amount),0),o=r.reduce(((e,t)=>e+t.todayValue),0),i=r.reduce(((e,t)=>e+t.preValue),0),u=r.reduce(((e,t)=>e+t.realised_amount),0),m=o-l-u;t(r),n({totalInvested:l.toFixed(2),currentValue:o.toFixed(2),totalDayChange:(o-i).toFixed(2),totalRealized:u.toFixed(2),totalUnRealized:m.toFixed(2),isProfit:o-l-u>0,profitPercentage:`${(m/l*100).toFixed(2)}%`,dayChangePercentage:`${((o-i)/i*100).toFixed(2)}%`})}}),[e]),d.createElement(p,{direction:"column",width:"100%",height:"100vh"},d.createElement(j,{minChildWidth:"120px",spacing:"40px",padding:"40px"},Object.keys(ue).map((e=>d.createElement(k,null,d.createElement(H,null,d.createElement(N,null,ue[e]),d.createElement(R,null,a[e])))))),d.createElement(se,{columns:ie,data:e}))}const de={header:!0,dynamicTyping:!0,skipEmptyLines:!0};function pe({isOpen:e,onClose:t}){const[a,n]=z.exports.useState([]),[r,l]=z.exports.useState([]),o=()=>{n([]),l([]),t()};return d.createElement(T,{closeOnOverlayClick:!1,isOpen:e,onClose:o,size:"7xl"},d.createElement(M,null),d.createElement(L,null,d.createElement(U,null,"Create your account"),d.createElement(A,null),d.createElement(W,{pb:6},a.length?d.createElement("div",{style:{maxHeight:"90vh",overflow:"scroll"}},d.createElement(x,{size:"sm"},d.createElement(C,null,d.createElement(w,null,r.map(((e,t)=>d.createElement(S,{key:t},e))))),d.createElement(F,null,a.map(((e,t)=>d.createElement(w,{key:t},r.map(((t,a)=>d.createElement(D,{key:a},e[t]))))))))):d.createElement(Q,{cssClass:"react-csv-input",label:"Upload CSV",onFileLoaded:(e,t)=>((e,t)=>{n(e),l(Object.keys(e[0]))})(e),parserOptions:de})),d.createElement(q,null,d.createElement(B,{onClick:async()=>{await(async(e=[])=>{const t=le.auth.user(),a=e.map((e=>c(s({},e),{userId:t.id,date:_(e.date,"DD-MM-YYYY").unix()}))),{data:n,error:r}=await le.from("transactions").insert(a);return n})(a),o()},colorScheme:"blue",mr:3},"Save"),d.createElement(B,{onClick:t},"Cancel"))))}function Ee(){const[e,t]=z.exports.useState(!1),a=[{icon:$,action:()=>t(!0),toolTip:"Upload Transactions"},{icon:K,action:()=>{le.auth.signOut()},toolTip:"Logout"}];return d.createElement("div",null,d.createElement(pe,{isOpen:e,onClose:()=>t(!1)}),d.createElement(p,{bgColor:"telegram.400",height:"50px",alignItems:"center",color:"#FFF",fontSize:"1em",fontWeight:"bold",padding:"5px",justifyItems:"flex-start",justifyContent:"space-between"},d.createElement(p,null,d.createElement("div",null,d.createElement(y,{as:v,to:"/home"},"Home"))),d.createElement(G,{fontSize:"1.75em",divider:d.createElement(J,null),spacing:"24px"},a.map(((e,t)=>d.createElement(X,{as:e.icon,onClick:e.action}))))))}function ge(e){const[t,a]=z.exports.useState(le.auth.session());le.auth.onAuthStateChange(((e,t)=>{a(t)}));const o=e=>{var a=e,{component:o}=a,i=((e,t)=>{var a={};for(var o in e)r.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&n)for(var o of n(e))t.indexOf(o)<0&&l.call(e,o)&&(a[o]=e[o]);return a})(a,["component"]);return d.createElement("div",null,d.createElement(Ee,null),d.createElement(ae,c(s({},i),{render:e=>t?d.createElement("div",null,d.createElement(o,s({},e))):d.createElement(ne,{to:"/login"})})))};return d.createElement(Z,null,d.createElement(ee,null,d.createElement(te,null,d.createElement(ae,{exact:!0,path:"/",render:()=>t?d.createElement(ne,{to:"/home"}):d.createElement(ne,{to:"/login"})}),d.createElement(ae,{exact:!0,path:"/login"},d.createElement(oe,{isLogin:!0})),d.createElement(ae,{exact:!0,path:"/signup"},d.createElement(oe,{isLogin:!1})),d.createElement(o,{exact:!0,path:"/home",component:me}))))}re.render(d.createElement(d.StrictMode,null,d.createElement(ge,null)),document.getElementById("root"));
