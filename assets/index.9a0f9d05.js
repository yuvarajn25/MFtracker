var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,s=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&o(e,a,t[a]);return e},c=(e,r)=>t(e,a(r));import{c as i,u as m,a as u,R as d,F as p,T as E,b as h,d as g,I as f,L as y,e as v,r as C,f as b,g as x,h as w,i as S,j as Y,k as D,l as I,m as P,n as F,o as O,p as V,q as _,S as M,B as N,s as j,t as H,v as k,w as z,M as R,x as T,y as L,z as U,A,C as q,D as W,E as B,G,H as Q,J as $,K as J,N as X,O as K,P as Z,Q as ee,U as te,V as ae,W as re,X as ne}from"./vendor.05bbaace.js";const le=i("https://sctuwgacucgmlfzywnvm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNjE2MjYxOSwiZXhwIjoxOTQxNzM4NjE5fQ.05_kxuSWS9RdNG_ba1KQIMXIcYXe_sD_eoPqlszQyAQ");function oe({isLogin:e}){const t=m();let a=u();le.auth.session()&&a.push("/home");return d.createElement(p,{height:"100vh",alignItems:"center",justifyContent:"center"},d.createElement(p,{direction:"column",backgroundColor:"gray.100",p:12,rounded:6},d.createElement(E,{mb:6,textAlign:"center",fontWeight:"bold"},e?"Login":"Signup"),d.createElement("form",{onSubmit:async r=>{r.preventDefault();const{email:{value:n},password:{value:l}}=r.target,o={email:n,password:l};if(e){const{error:e}=await le.auth.signIn(o);e&&t({title:e.message,position:"top",status:"error",isClosable:!0}),a.push("/home")}else{const{error:e}=await le.auth.signUp(o);e&&t({title:e.message,position:"top",status:"error",isClosable:!0})}}},d.createElement(h,{id:"email",isRequired:!0},d.createElement(g,{fontSize:"85%"},"Email"),d.createElement(f,{borderColor:"blackAlpha.300",mb:6,variant:"filled",placeholder:"Email",type:"email",name:"email"})),d.createElement(h,{id:"Password",isRequired:!0},d.createElement(g,{fontSize:"85%"},"Password"),d.createElement(f,{borderColor:"blackAlpha.300",type:"password",mb:6,variant:"filled",placeholder:"*********",name:"password"})),d.createElement(f,{type:"submit",bgColor:"#1293d2",color:"#fff",value:e?"Login":"Signup"})," "),d.createElement(E,{mt:3},d.createElement(y,{as:v,to:e?"/signup":"/login"},e?"do not have account? Signup here":"Already have account? Login here"))))}function se({columns:e,data:t}){const{getTableProps:a,getTableBodyProps:r,headerGroups:n,rows:l,prepareRow:o}=C.exports.useTable({columns:e,data:t},C.exports.useSortBy);return d.createElement(b,s({manualSortBy:!0,variant:"striped",colorScheme:"telegram"},a()),d.createElement(x,null,n.map((e=>d.createElement(w,s({},e.getHeaderGroupProps()),e.headers.map((e=>d.createElement(S,c(s({},e.getHeaderProps(e.getSortByToggleProps())),{isNumeric:e.isNumeric}),e.render("Header"),d.createElement(Y.span,{pl:"4"},e.isSorted?e.isSortedDesc?d.createElement(D,{"aria-label":"sorted descending"}):d.createElement(I,{"aria-label":"sorted ascending"}):null)))))))),d.createElement(P,s({},r()),l.map((e=>(o(e),d.createElement(w,s({},e.getRowProps()),e.cells.map((e=>d.createElement(F,c(s({},e.getCellProps()),{isNumeric:e.column.isNumeric}),e.render("Cell"))))))))))}const ce=async e=>{const t={};await Promise.all(e.map((async e=>{const a=await(async e=>{const{data:t,error:a}=await le.from("navHistory").select("*").eq("schemeCode",e).order("date",{ascending:!1}).limit(2);return t})(e);a.length>0&&(t[e]=a.map((e=>c(s({},e),{date:O.unix(e.date).format("DD-MM-YYYY")}))))})));const a=O().subtract(1,"days");if([6,7].includes(a.isoWeekday()))return t;if(a.format("DD-MM-YYYY")===t[e[0]][0].date)return t;const r={method:"GET",url:"https://latest-mutual-fund-nav.p.rapidapi.com/fetchHistoricalNAV",params:{Date:a.format("DD-MMM-YYYY"),SchemeCode:e.join(",")},headers:{"x-rapidapi-host":"latest-mutual-fund-nav.p.rapidapi.com","x-rapidapi-key":"7a8ebddfc2msh30345f773107b49p1768f1jsn25911e4f7501"}},n=(await V.request(r)).data.map((e=>{const t=a.format("DD-MM-YYYY");return{nav:e["Net Asset Value"],date:t,schemeCode:e["Scheme Code"],id:`${e["Scheme Code"]}_${t}`}}));return n.forEach((e=>t[e.schemeCode].unshift(e))),n.length&&await le.from("navHistory").upsert(n.map((e=>{const t=O(e.date,"DD-MM-YYYY").unix();return c(s({},e),{id:`${e.schemeCode}_${t}`,date:O(e.date,"DD-MM-YYYY").unix()})}))),console.log("res",t),t},ie=[{Header:"Code",accessor:"scheme_code"},{Header:"Name",accessor:"scheme_name"},{Header:"Source",accessor:"bank_name"},{Header:"Units",accessor:"total_units",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Invested",accessor:"total_amount",isNumeric:!0,sortable:!0,sortMethod:(e,t,a)=>{console.log(e,t)}},{Header:"Nav Date",accessor:"lastDate",isNumeric:!0},{Header:"Last Nav Value",accessor:"nav",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Current Value",accessor:"todayValue",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Revenue",accessor:"difference",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Revenue %",accessor:"revenue%",sortable:!0,sortType:({values:e},{values:t},a,r)=>e.difference/e.total_amount*100>t.difference/t.total_amount*100?1:-1,Cell:({row:{values:{difference:e,total_amount:t}}})=>{const a=e/t*100;return d.createElement(d.Fragment,null,d.createElement(z,{type:e>0?"increase":"decrease"}),a.toFixed(2))}},{Header:"Day Change",accessor:"preValue",sortType:({values:e},{values:t},a,r)=>e.todayValue-e.preValue>t.todayValue-t.preValue?1:-1,Cell:({row:{values:{todayValue:e,preValue:t}}})=>{const a=e-t;return d.createElement(d.Fragment,null,d.createElement(z,{type:a>0?"increase":"decrease"}),a.toFixed(2))}}],me={totalInvested:"Total Invested",currentValue:"Current Value",totalRealized:"Realized",totalUnRealized:"Un Realized",profitPercentage:"Difference %",totalDayChange:"Day Change",dayChangePercentage:"Day Change %"};function ue(){const[e,t]=_.exports.useState([]),[a,r]=_.exports.useState({totalInvested:0,currentValue:0,totalDayChange:0,totalRealized:0,totalUnRealized:0,profitPercentage:0,dayChangePercentage:0});return _.exports.useEffect((async()=>{if(0===e.length){const e=le.auth.user(),{data:a}=await le.rpc("mf_summary").eq("user_id",e.id),n=await ce(a.map((e=>e.scheme_code))),l=await Promise.all(a.map((async e=>{const[t,a]=n[e.scheme_code],r=t.nav*e.total_units,l=r-e.total_amount;return c(s({},e),{nav:t.nav,lastDate:t.date,preNav:a.nav,preValue:a.nav*e.total_units,todayValue:r,difference:l})}))),o=l.reduce(((e,t)=>e+t.total_amount),0),i=l.reduce(((e,t)=>e+t.todayValue),0),m=l.reduce(((e,t)=>e+t.preValue),0),u=l.reduce(((e,t)=>e+t.realised_amount),0),d=i-o-u;t(l),r({totalInvested:o.toFixed(2),currentValue:i.toFixed(2),totalDayChange:(i-m).toFixed(2),totalRealized:u.toFixed(2),totalUnRealized:d.toFixed(2),isProfit:i-o-u>0,profitPercentage:`${(d/o*100).toFixed(2)}%`,dayChangePercentage:`${((i-m)/m*100).toFixed(2)}%`})}}),[e]),d.createElement(p,{direction:"column",width:"100%",height:"100vh"},d.createElement(M,{minChildWidth:"120px",spacing:"40px",padding:"40px"},Object.keys(me).map((e=>d.createElement(N,null,d.createElement(j,null,d.createElement(H,null,me[e]),d.createElement(k,null,a[e])))))),d.createElement(se,{columns:ie,data:e}))}const de={header:!0,dynamicTyping:!0,skipEmptyLines:!0};function pe({isOpen:e,onClose:t}){const[a,r]=_.exports.useState([]),[n,l]=_.exports.useState([]),o=()=>{r([]),l([]),t()};return d.createElement(R,{closeOnOverlayClick:!1,isOpen:e,onClose:o,size:"7xl"},d.createElement(T,null),d.createElement(L,null,d.createElement(U,null,"Create your account"),d.createElement(A,null),d.createElement(q,{pb:6},a.length?d.createElement("div",{style:{maxHeight:"90vh",overflow:"scroll"}},d.createElement(b,{size:"sm"},d.createElement(x,null,d.createElement(w,null,n.map(((e,t)=>d.createElement(S,{key:t},e))))),d.createElement(P,null,a.map(((e,t)=>d.createElement(w,{key:t},n.map(((t,a)=>d.createElement(F,{key:a},e[t]))))))))):d.createElement(G,{cssClass:"react-csv-input",label:"Upload CSV",onFileLoaded:(e,t)=>((e,t)=>{r(e),l(Object.keys(e[0]))})(e),parserOptions:de})),d.createElement(W,null,d.createElement(B,{onClick:async()=>{await(async(e=[])=>{const t=le.auth.user(),a=e.map((e=>c(s({},e),{userId:t.id,date:O(e.date,"DD-MM-YYYY").unix()}))),{data:r,error:n}=await le.from("transactions").insert(a);return r})(a),o()},colorScheme:"blue",mr:3},"Save"),d.createElement(B,{onClick:o},"Cancel"))))}function Ee(){const[e,t]=_.exports.useState(!1),a=[{icon:X,action:()=>t(!0),toolTip:"Upload Transactions"},{icon:K,action:()=>{le.auth.signOut()},toolTip:"Logout"}];return d.createElement("div",null,d.createElement(pe,{isOpen:e,onClose:()=>t(!1)}),d.createElement(p,{bgColor:"telegram.400",height:"50px",alignItems:"center",color:"#FFF",fontSize:"1em",fontWeight:"bold",padding:"5px",justifyItems:"flex-start",justifyContent:"space-between"},d.createElement(p,null,d.createElement("div",null,d.createElement(y,{as:v,to:"/home"},"Home"))),d.createElement(Q,{fontSize:"1.75em",divider:d.createElement($,null),spacing:"24px"},a.map(((e,t)=>d.createElement(J,{as:e.icon,onClick:e.action}))))))}function he(e){const[t,a]=_.exports.useState(le.auth.session());le.auth.onAuthStateChange(((e,t)=>{a(t)}));const o=e=>{var a=e,{component:o}=a,i=((e,t)=>{var a={};for(var o in e)n.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&r)for(var o of r(e))t.indexOf(o)<0&&l.call(e,o)&&(a[o]=e[o]);return a})(a,["component"]);return d.createElement("div",null,d.createElement(Ee,null),d.createElement(ae,c(s({},i),{render:e=>t?d.createElement("div",null,d.createElement(o,s({},e))):d.createElement(re,{to:"/login"})})))};return d.createElement(Z,null,d.createElement(ee,null,d.createElement(te,null,d.createElement(ae,{exact:!0,path:"/",render:()=>t?d.createElement(re,{to:"/home"}):d.createElement(re,{to:"/login"})}),d.createElement(ae,{exact:!0,path:"/login"},d.createElement(oe,{isLogin:!0})),d.createElement(ae,{exact:!0,path:"/signup"},d.createElement(oe,{isLogin:!1})),d.createElement(o,{exact:!0,path:"/home",component:ue}))))}ne.render(d.createElement(d.StrictMode,null,d.createElement(he,null)),document.getElementById("root"));
