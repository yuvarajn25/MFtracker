var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,s=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&o(e,a,t[a]);return e},c=(e,r)=>t(e,a(r));import{c as i,u,a as m,R as d,F as p,T as E,b as g,d as h,I as f,L as y,e as v,r as b,M as C,f as x,g as w,h as S,i as I,j as P,k as O,B as _,l as F,m as V,n as D,o as N,p as k,q as z,s as R,t as j,v as H,w as T,x as L,y as M,z as U,S as Y,A,C as q,D as B,E as G,G as J,H as Q,J as W,K as $,N as X,O as K,P as Z}from"./vendor.5fe4bbd9.js";const ee=i("https://sctuwgacucgmlfzywnvm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNjE2MjYxOSwiZXhwIjoxOTQxNzM4NjE5fQ.05_kxuSWS9RdNG_ba1KQIMXIcYXe_sD_eoPqlszQyAQ");function te({isLogin:e}){const t=u();let a=m();ee.auth.session()&&a.push("/home");return d.createElement(p,{height:"100vh",alignItems:"center",justifyContent:"center"},d.createElement(p,{direction:"column",backgroundColor:"gray.100",p:12,rounded:6},d.createElement(E,{mb:6,textAlign:"center",fontWeight:"bold"},e?"Login":"Signup"),d.createElement("form",{onSubmit:async r=>{r.preventDefault();const{email:{value:n},password:{value:l}}=r.target,o={email:n,password:l};if(e){const{error:e}=await ee.auth.signIn(o);e&&t({title:e.message,position:"top",status:"error",isClosable:!0}),a.push("/home")}else{const{error:e}=await ee.auth.signUp(o);e&&t({title:e.message,position:"top",status:"error",isClosable:!0})}}},d.createElement(g,{id:"email",isRequired:!0},d.createElement(h,{fontSize:"85%"},"Email"),d.createElement(f,{borderColor:"blackAlpha.300",mb:6,variant:"filled",placeholder:"Email",type:"email",name:"email"})),d.createElement(g,{id:"Password",isRequired:!0},d.createElement(h,{fontSize:"85%"},"Password"),d.createElement(f,{borderColor:"blackAlpha.300",type:"password",mb:6,variant:"filled",placeholder:"*********",name:"password"})),d.createElement(f,{type:"submit",bgColor:"#1293d2",color:"#fff",value:e?"Login":"Signup"})," "),d.createElement(E,{mt:3},d.createElement(y,{as:v,to:e?"/signup":"/login"},e?"do not have account? Signup here":"Already have account? Login here"))))}const ae={header:!0,dynamicTyping:!0,skipEmptyLines:!0};function re({isOpen:e,onClose:t}){const[a,r]=b.exports.useState([]),[n,l]=b.exports.useState([]),o=()=>{r([]),l([]),t()};return d.createElement(C,{closeOnOverlayClick:!1,isOpen:e,onClose:o,size:"7xl"},d.createElement(x,null),d.createElement(w,null,d.createElement(S,null,"Create your account"),d.createElement(I,null),d.createElement(P,{pb:6},a.length?d.createElement("div",{style:{maxHeight:"90vh",overflow:"scroll"}},d.createElement(D,{size:"sm"},d.createElement(N,null,d.createElement(k,null,n.map(((e,t)=>d.createElement(z,{key:t},e))))),d.createElement(R,null,a.map(((e,t)=>d.createElement(k,{key:t},n.map(((t,a)=>d.createElement(j,{key:a},e[t]))))))))):d.createElement(V,{cssClass:"react-csv-input",label:"Upload CSV",onFileLoaded:(e,t)=>((e,t)=>{r(e),l(Object.keys(e[0]))})(e),parserOptions:ae})),d.createElement(O,null,d.createElement(_,{onClick:async()=>{const e=ee.auth.user(),t=a.map((t=>c(s({},t),{userId:e.id,date:F(new Date(t.date)).unix()})));await ee.from("transactions").insert(t),o()},colorScheme:"blue",mr:3},"Save"),d.createElement(_,{onClick:t},"Cancel"))))}function ne({columns:e,data:t}){const{getTableProps:a,getTableBodyProps:r,headerGroups:n,rows:l,prepareRow:o}=H.exports.useTable({columns:e,data:t},H.exports.useSortBy);return d.createElement(D,s({manualSortBy:!0,variant:"striped",colorScheme:"telegram"},a()),d.createElement(N,null,n.map((e=>d.createElement(k,s({},e.getHeaderGroupProps()),e.headers.map((e=>d.createElement(z,c(s({},e.getHeaderProps(e.getSortByToggleProps())),{isNumeric:e.isNumeric}),e.render("Header"),d.createElement(T.span,{pl:"4"},e.isSorted?e.isSortedDesc?d.createElement(L,{"aria-label":"sorted descending"}):d.createElement(M,{"aria-label":"sorted ascending"}):null)))))))),d.createElement(R,s({},r()),l.map((e=>(o(e),d.createElement(k,s({},e.getRowProps()),e.cells.map((e=>d.createElement(j,c(s({},e.getCellProps()),{isNumeric:e.column.isNumeric}),e.render("Cell"))))))))))}const le=[{Header:"Code",accessor:"scheme_code"},{Header:"Name",accessor:"scheme_name"},{Header:"Units",accessor:"total_units",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Invested",accessor:"total_amount",isNumeric:!0,sortable:!0,sortMethod:(e,t,a)=>{console.log(e,t)}},{Header:"Nav Date",accessor:"lastDate",isNumeric:!0},{Header:"Current Value",accessor:"todayValue",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Revenue",accessor:"difference",isNumeric:!0,Cell:({value:e})=>parseFloat(e).toFixed(2)},{Header:"Revenue %",accessor:"revenue%",sortable:!0,sortType:({values:e},{values:t},a,r)=>e.difference/e.total_amount*100>t.difference/t.total_amount*100?1:-1,Cell:({row:{values:{difference:e,total_amount:t}}})=>{const a=e/t*100;return d.createElement(d.Fragment,null,d.createElement(J,{type:e>0?"increase":"decrease"}),a.toFixed(2))}},{Header:"Day Change",accessor:"preValue",sortType:({values:e},{values:t},a,r)=>e.todayValue-e.preValue>t.todayValue-t.preValue?1:-1,Cell:({row:{values:{todayValue:e,preValue:t}}})=>{const a=e-t;return d.createElement(d.Fragment,null,d.createElement(J,{type:a>0?"increase":"decrease"}),a.toFixed(2))}}],oe={totalInvested:"Total Invested",currentValue:"Current Value",totalRealized:"Realized",totalUnRealized:"Un Realized",profitPercentage:"Difference %",totalDayChange:"Day Change",dayChangePercentage:"Day Change %"};function se(){const[e,t]=b.exports.useState([]),[a,r]=b.exports.useState(!1),[n,l]=b.exports.useState({totalInvested:0,currentValue:0,totalDayChange:0,totalRealized:0,totalUnRealized:0,profitPercentage:0,dayChangePercentage:0});return b.exports.useEffect((async()=>{if(0===e.length){const e=ee.auth.user(),{data:a}=await ee.rpc("mf_summary").eq("user_id",e.id),r=await Promise.all(a.map((async e=>{const[t,a]=await(async e=>{var t,a;const{data:r,error:n}=await ee.from("navHistory").select("*").eq("schemeCode",e).order("id",{ascending:!1}).limit(2);if(r.length){const e=F();if(e.isoWeekday()>5)return r;if(e.diff(F.unix(r[0].date),"days")<=1)return r}const l=await U.get(`https://api.mfapi.in/mf/${e}`);return await ee.from("navHistory").upsert(null==(t=null==l?void 0:l.data)?void 0:t.data.splice(0,5).map((t=>{const a=F(t.date,"DD-MM-YYYY").unix();return c(s({},t),{date:a,schemeCode:e,id:`${e}_${a}`})}))),null==(a=null==l?void 0:l.data)?void 0:a.data.splice(0,2)})(e.scheme_code),r=t.nav*e.total_units,n=r-e.total_amount;return c(s({},e),{nav:t.nav,lastDate:t.date,preNav:a.nav,preValue:a.nav*e.total_units,todayValue:r,difference:n})}))),n=r.reduce(((e,t)=>e+t.total_amount),0),o=r.reduce(((e,t)=>e+t.todayValue),0),i=r.reduce(((e,t)=>e+t.preValue),0),u=r.reduce(((e,t)=>e+t.realised_amount),0),m=o-n-u;t(r),l({totalInvested:n.toFixed(2),currentValue:o.toFixed(2),totalDayChange:(o-i).toFixed(2),totalRealized:u.toFixed(2),totalUnRealized:m.toFixed(2),isProfit:o-n-u>0,profitPercentage:`${(m/n*100).toFixed(2)}%`,dayChangePercentage:`${((o-i)/i*100).toFixed(2)}%`})}}),[e]),d.createElement(p,{direction:"column",width:"100%",height:"100vh"},d.createElement(_,{onClick:()=>r(!0)},"Upload Transactions"),d.createElement(re,{isOpen:a,onClose:()=>r(!1)}),d.createElement(Y,{minChildWidth:"120px",spacing:"40px",padding:"40px"},Object.keys(oe).map((e=>d.createElement(A,null,d.createElement(q,null,d.createElement(B,null,oe[e]),d.createElement(G,null,n[e])))))),d.createElement(ne,{columns:le,data:e}))}function ce(e){const[t,a]=b.exports.useState(ee.auth.session());ee.auth.onAuthStateChange(((e,t)=>{a(t)}));const o=e=>{var a=e,{component:o}=a,i=((e,t)=>{var a={};for(var o in e)n.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&r)for(var o of r(e))t.indexOf(o)<0&&l.call(e,o)&&(a[o]=e[o]);return a})(a,["component"]);return d.createElement(X,c(s({},i),{render:e=>t?d.createElement("div",null,d.createElement(o,s({},e))):d.createElement(K,{to:"/login"})}))};return d.createElement(Q,null,d.createElement(W,null,d.createElement($,null,d.createElement(X,{exact:!0,path:"/",render:()=>t?d.createElement(K,{to:"/home"}):d.createElement(K,{to:"/login"})}),d.createElement(X,{exact:!0,path:"/login"},d.createElement(te,{isLogin:!0})),d.createElement(X,{exact:!0,path:"/signup"},d.createElement(te,{isLogin:!1})),d.createElement(o,{exact:!0,path:"/home",component:se}))))}Z.render(d.createElement(d.StrictMode,null,d.createElement(ce,null)),document.getElementById("root"));
